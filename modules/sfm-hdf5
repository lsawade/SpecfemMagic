#%Module

proc ModulesHelp { } {
   puts stderr "Module is used to load HDF5 compiled for use with Specfem"
}

module-whatis "This module load all necessary variables to build and use HDF5"

prereq sfm

# Get root
set SFM_ROOT $::env(SFM_ROOT)
set PACKAGES "${SFM_ROOT}/packages"
set HDF5MAINDIR "${PACKAGES}/hdf5"

# Variables from the configuration file
source ${SFM_ROOT}/tcl/read_cfg.tcl
cfg::parse_file  ${SFM_ROOT}/config.cfg

set hdf5Link "$cfg::HDF5(LINK)"
set HDF5_BUILD_DIR "${HDF5MAINDIR}/build"
set HDF5DIR "${HDF5MAINDIR}/build/install"



setenv HDF5_MAINDIR $HDF5MAINDIR
setenv HDF5_DIR $HDF5DIR
setenv HDF5_ROOT "${HDF5DIR}"
setenv HDF5_CC "${HDF5DIR}/bin/h5pcc"
setenv HDF5_FC "${HDF5DIR}/bin/h5fc"
setenv MPIFC_HDF5 "${HDF5DIR}/bin/h5fc"
setenv HDF5_MPI "ON"
setenv HDF5_LINK $hdf5Link

# Set path variable
set PATH $::env(PATH)
prepend-path PATH "$HDF5DIR/bin"
prepend-path LD_LIBRARY_PATH "$HDF5DIR/lib"
prepend-path C_INCLUDE_PATH "$HDF5DIR/include"
prepend-path F_INCLUDE_PATH "$HDF5DIR/include"
prepend-path PKG_CONFIG_PATH "$HDF5DIR/lib/pkgconfig"



