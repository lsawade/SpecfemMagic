#%Module

proc ModulesHelp { } {
   puts stderr "Module is used to load ADIOS compiled for use with Specfem"
}

module-whatis "This module load all necessary variables to build and use ADIOS"

prereq sfm

# Get root
set SFM_ROOT $::env(SFM_ROOT)
set PACKAGES "${SFM_ROOT}/packages"
set ADIOSDIR "${PACKAGES}/adios"

# Variables from the configuration file
source ${SFM_ROOT}/tcl/read_cfg.tcl
cfg::parse_file  ${SFM_ROOT}/config.cfg

# Variables from the configuration file
set adiosLink "$cfg::ADIOS(LINK)"
set adiosVersion "$cfg::ADIOS(VERSION)"

setenv ADIOS_LINK $adiosLink
setenv ADIOS_BUILD $PACKAGES/adios-build
set ADIOSINSTALL ${PACKAGES}/adios-install
setenv ADIOS_INSTALL $ADIOSINSTALL

# ADIOS version specific things
if {$adiosVersion=="2"} {
    setenv ADIOS_WITH "--with-adios2"
    setenv ADIOS_CONFIG "${ADIOSINSTALL}/bin/adios2_config"
} else {
    setenv ADIOS_WITH "--with-adios"
    setenv ADIOS_CONFIG "${ADIOSINSTALL}/bin/adios_config"
}


# Set path variable
set PATH $::env(PATH)
pushenv PATH "$ADIOSDIR/bin:$PATH"